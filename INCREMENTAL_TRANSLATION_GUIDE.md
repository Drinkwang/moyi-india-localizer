# 智能增量翻译功能指南

## 🎯 功能简介

智能增量翻译是一个强大的功能，它能够：
- **智能跳过**已有翻译，只翻译空的目标语言行
- **支持混合翻译**，例如en列已翻译但lzh列为空的情况
- **保持现有翻译**不变，只填补缺失的翻译内容
- **完美支持增量工作流**，适合分批次翻译大型项目

## 🔧 工作原理

### 逐行智能判断
系统会对每一行进行智能判断：

1. **源文本为空** → 目标也设为空，跳过
2. **目标已有翻译** → 保持现有翻译，跳过
3. **源文本不为空 + 目标为空** → 进行新翻译

### 实际示例

假设你的CSV文件是这样的：
```csv
keys,zh,en,ja
item1,苹果,Apple,
item2,香蕉,,バナナ
item3,橙子,Orange,
item4,,Empty,
item5,葡萄,,
```

当你翻译`en`列时：
- item1: 保持`Apple`，不翻译
- item2: 翻译`香蕉` → `Banana`
- item3: 保持`Orange`，不翻译
- item4: 源为空，保持为空
- item5: 翻译`葡萄` → `Grape`

## 📊 翻译状态显示

### 控制台输出
```
🔍 语言列 'en' 已存在，进行增量翻译...
翻译统计:
  需要翻译: 2 项
  已有翻译: 2 项
  空源文本: 1 项
  总计: 5 项
```

### UI界面显示
- **进度**: `语言1/1 - 第3/5项 - 新翻译`
- **原文**: `葡萄`
- **译文**: `Grape [新翻译]`

### 动作类型
- `🔄 新翻译`: 调用AI进行翻译
- `⏭️ 保持现有翻译`: 跳过已翻译内容
- `⚪ 空源文本`: 跳过空文本

## 🎮 使用方法

### 基本步骤
1. **选择CSV文件**（可以是已部分翻译的文件）
2. **设置源语言和目标语言**
3. **点击"翻译CSV文件"**
4. **观察实时进度和翻译状态**

### 增量翻译工作流
1. **第一轮**: 翻译`zh → en`
2. **第二轮**: 使用输出文件，翻译`zh → ja`
3. **第三轮**: 使用输出文件，翻译`zh → ru`
4. **补完翻译**: 如果某些行失败，重新翻译会自动跳过已完成的行

### 多语言同时翻译
```
源语言: zh
目标语言: en,ja,ru,lzh
```
系统会智能处理每种语言的现有翻译状态。

## 💡 最佳实践

### 推荐工作流
1. **备份原文件**
2. **小批量测试**（先翻译几行验证效果）
3. **分语言翻译**（一次翻译一种语言，便于管理）
4. **定期检查**（查看输出文件质量）
5. **增量补完**（对失败的翻译重新处理）

### 性能优化
- **只翻译需要的内容**，避免浪费API调用
- **保持现有翻译**，减少重复工作
- **智能进度显示**，清楚了解翻译状态

## 🚀 优势特点

### 效率提升
- ⚡ **快速跳过**已翻译内容
- 🎯 **精准翻译**需要的行
- 📊 **实时统计**翻译进度

### 成本节约
- 💰 **节省API调用**费用
- ⏰ **节省翻译时间**
- 🔄 **支持断点续传**

### 用户友好
- 👁️ **可视化进度**显示
- 📝 **详细状态**反馈
- 🎛️ **完整控制**功能（暂停/恢复/取消）

## 🧪 测试验证

运行测试脚本验证功能：
```bash
godot --headless -s test_incremental_translation.gd
```

测试涵盖：
- ✅ 新语言列创建
- ✅ 部分翻译文件处理
- ✅ 混合翻译状态处理
- ✅ 重复翻译跳过验证

## 📋 注意事项

### 文件格式
- 必须是标准的Godot CSV格式
- 第一列必须是`keys`
- 语言列名称必须匹配语言代码

### 翻译质量
- 现有翻译会被完全保留
- 新翻译使用配置的AI服务
- 支持专业翻译提示词

### 错误处理
- 翻译失败的行会保持为空
- 可以重新运行继续翻译失败的内容
- 详细的错误信息会在控制台显示

---

💡 **提示**: 这个功能特别适合大型游戏本地化项目，可以分阶段、分语言进行翻译，大大提高工作效率！ 